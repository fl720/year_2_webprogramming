<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../css/hiit_page.css">
    <title>HIIT</title>
    <style>

    </style>
</head>
<body>
    <div class="exercise-title">Push Up</div>
    <div class="exercise-statement" id="exercise-statement">On the ground, set your hands at a distance that is slightly wider than shoulder-width apart. Draw a straight line from your chest down to the floor</div>
    <div class="clock-container">
        <div class="clock" id="clock">
            <div class="hand" id="second-hand"></div>
            <div class="clock-text" id="clock-text">0:00:00</div>
        </div>
    </div>
    <div class="controls">
        <input type="number" id="hours" placeholder="Hours" min="0">
        <input type="number" id="minutes" placeholder="Minutes" min="0">
        <input type="number" id="seconds" placeholder="Seconds" min="0">
        <button id="start">Start</button>
        <button id="pause">Pause</button>
        <button id="reset">Reset</button>
    </div>

    <script>
        const clockText    = document.getElementById('clock-text');
        const secondHand   = document.getElementById('second-hand');
        const startButton  = document.getElementById('start');
        const pauseButton  = document.getElementById('pause');
        const resetButton  = document.getElementById('reset');
        const hoursInput   = document.getElementById('hours');
        const minutesInput = document.getElementById('minutes');
        const secondsInput = document.getElementById('seconds');

        let totalTime = 0;
        let timeLeft = 0;
        let timer;
        let isPaused = false;

        function playBeep(frequency) {
            const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = audioCtx.createOscillator();
            oscillator.type = 'sine';
            oscillator.frequency.setValueAtTime(frequency, audioCtx.currentTime);
            oscillator.connect(audioCtx.destination);
            oscillator.start();
            oscillator.stop(audioCtx.currentTime + 0.2);
        }

        function updateClockText() {
            const hours = Math.floor(timeLeft / 3600);
            const minutes = Math.floor((timeLeft % 3600) / 60);
            const seconds = timeLeft % 60;
            clockText.textContent = `${hours}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        function updateSecondHand() {
            const totalSeconds = totalTime;
            const elapsedSeconds = totalTime - timeLeft;
            const angle = (((totalTime % 60) / 60) * 360 - 90 - (elapsedSeconds % 60) * 6);
            secondHand.style.transform = `rotate(${angle}deg) translateX(-50%)`;
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timer = setInterval(() => {
                if (timeLeft > 0) {
                    timeLeft--;
                    updateClockText();
                    updateSecondHand();
                    if (timeLeft <= 5 && timeLeft > 0) {
                        playBeep(440);
                    } else if ( timeLeft == 0 ) { 
                        playBeep(493.8);
                    }
                } else {
                    clearInterval(timer);
                    // playBeep(493.8);
                    clockText.textContent = "Time's up!";
                    secondHand.style.transform = `rotate(-90deg) translateX(-50%)`;
                }
            }, 1000);
        }

        startButton.addEventListener('click', () => {
            clearInterval(timer);
            const hours = parseInt(hoursInput.value) || 0;
            const minutes = parseInt(minutesInput.value) || 0;
            const seconds = parseInt(secondsInput.value) || 0;
            totalTime = timeLeft = (hours * 3600) + (minutes * 60) + seconds;
            clockText.textContent = `${hours}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;

            const initialAngle = ((totalTime % 60) / 60) * 360 - 90;
            secondHand.style.transform = `rotate(${initialAngle}deg) translateX(-50%)`;
            // secondHand.style.background = 'red' ; 
            secondHand.classList.add('red');
            updateClockText();
            updateSecondHand();
            startTimer();
        });

        pauseButton.addEventListener('click', () => {
            if (isPaused) {
                startTimer();
                pauseButton.textContent = 'Pause';
            } else {
                clearInterval(timer);
                pauseButton.textContent = 'Resume';
            }
            isPaused = !isPaused;
        });

        resetButton.addEventListener('click', () => {
            clearInterval(timer);
            const hours = parseInt(hoursInput.value) || 0;
            const minutes = parseInt(minutesInput.value) || 0;
            const seconds = parseInt(secondsInput.value) || 0;
            totalTime = timeLeft = (hours * 3600) + (minutes * 60) + seconds;
            clockText.textContent = `${hours}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;

            const initialAngle = ((totalTime % 60) / 60) * 360 - 90;
            secondHand.style.transform = `rotate(${initialAngle}deg) translateX(-50%)`;
            pauseButton.textContent = 'Pause';
            isPaused = false;
        });
    </script>
</body>
</html>
